<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: react.js | blog.koba04.com]]></title>
  <link href="http://blog.koba04.com/blog/categories/react-dot-js/atom.xml" rel="self"/>
  <link href="http://blog.koba04.com/"/>
  <updated>2016-04-21T18:51:13+09:00</updated>
  <id>http://blog.koba04.com/</id>
  <author>
    <name><![CDATA[koba04]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[React.js Links vol.2 4/15〜4/19]]></title>
    <link href="http://blog.koba04.com/post/2016/04/19/reactjs-links-vol2/"/>
    <updated>2016-04-19T19:19:19+09:00</updated>
    <id>http://blog.koba04.com/post/2016/04/19/reactjs-links-vol2</id>
    <content type="html"><![CDATA[<p>これはReactに関する記事や気になるissueなどのリンクを紹介する記事です。</p>

<!-- more -->


<h2>Server-side Environments (React documentation)</h2>

<ul>
<li><a href="http://facebook.github.io/react/docs/environments.html">http://facebook.github.io/react/docs/environments.html</a></li>
</ul>


<p>あまり内容はありませんが、NashornとNode環境でReactを使った例を紹介するドキュメントが追加されました。</p>

<h2>Error reporting in production #2686 (React Issue)</h2>

<ul>
<li><a href="https://github.com/facebook/react/issues/2686">https://github.com/facebook/react/issues/2686</a></li>
</ul>


<p>かなり前のIssueですが、最近また盛り上がっているので紹介します。</p>

<p>Reactでは、warningとerrorの2種類のログレベルがありますが、現在は<code>NODE_ENV</code>がproductionであるかどうかでログを有効にするか無効にするかを切り替えることしかできません。
このissueはその辺りの改善に関するものです。</p>

<p>前回紹介したリンクでも、developmentビルドとproductionビルドのパフォーマンスの違いについてありましたが、developmentビルドでは実行速度を気にせずにデバッグログを出力していて、productionビルドでは速度優先で不要なチェックは一切行われていません。
その結果、パフォーマンスに大きな違いがあります。</p>

<p>そのため、developmentビルドのままで本番に投入することも難しく、かといってproductionビルドのままでerrorのログを確認したいという場面に対応できていません。
現在作り直しが行われているPerf周りでもPROFILEフラグをという話もあるので、その辺りとあわせて<code>REACT_ENV</code>のような新しい仕組みが入るかもしれません。</p>

<h2>Two Weird Tricks with Redux (Blog)</h2>

<ul>
<li><a href="http://jlongster.com/Two-Weird-Tricks-with-Redux">http://jlongster.com/Two-Weird-Tricks-with-Redux</a></li>
</ul>


<p>Firefox Developer Toolの開発をしている<a href="https://twitter.com/jlongster">@jlongster</a>さんによるFirefox Developer Toolsの開発にReduxを使った時の話です。
非同期処理をどうやって扱ったかということが書かれています。</p>

<p>言及されているソースはこのあたりにあるので気になる人は見るといいと思います。</p>

<ul>
<li><a href="https://github.com/mozilla/gecko-dev/tree/master/devtools/client/debugger/content">https://github.com/mozilla/gecko-dev/tree/master/devtools/client/debugger/content</a></li>
</ul>


<h2>React Flip Move (Library)</h2>

<ul>
<li><a href="https://github.com/joshwcomeau/react-flip-move/">https://github.com/joshwcomeau/react-flip-move/</a></li>
</ul>


<p>React Componentをアニメーションさせるためのライブラリーです。
READMEを見る限り、シンプルで使いやすそうです。react-motionを使っているのかと思ったけど独自実装でした。</p>

<h2>What to use for React styling? (Blog)</h2>

<ul>
<li><a href="http://andrewhfarmer.com/how-to-style-react/">http://andrewhfarmer.com/how-to-style-react/</a></li>
</ul>


<p>ReactとCSSをどのように組み合わせるのかを解説したエントリーです。
MethodologiesとPreprocessorsとPostprocessorsとInline Style Helpersのアプローチに分けて、それぞれどんな特徴でどんなライブラリーがあるということが解説されています。
ReactとCSSの扱いに悩んでいる人は見てみるといいかもしれません。</p>

<h2>Proposal: Add support for observable spec interop point #1631 (Redux Issue)</h2>

<ul>
<li><a href="https://github.com/reactjs/redux/issues/1631">https://github.com/reactjs/redux/issues/1631</a></li>
<li><a href="https://github.com/reactjs/redux/pull/1632">https://github.com/reactjs/redux/pull/1632</a></li>
</ul>


<p>ReduxのStoreを現在stage1のes-observableの<code>Symbol.observable</code>に対応させるIssueとPRです。
これにより、RxJS 5やその他のライブラリーとも組み合わせやすくなります。</p>

<p>PR出してるのはRxJS 5のメインの開発者である<a href="https://github.com/blesh">blesh</a>さんです。
<code>Symbol.observable</code>のponyfillには<a href="https://github.com/blesh/symbol-observable">blesh/symbol-observable</a>が使われています。</p>

<h2>eslint-config-airbnb 7,0 (Library)</h2>

<ul>
<li><a href="https://github.com/airbnb/javascript/blob/master/packages/eslint-config-airbnb/CHANGELOG.md#700--2016-04-11">https://github.com/airbnb/javascript/blob/master/packages/eslint-config-airbnb/CHANGELOG.md#700--2016-04-11</a></li>
</ul>


<p>Reactに関するLintも含んでいるeslint-config-airbnbの7.0がリリースされています。
React Componentのaccessibilityを検査する<code>eslint-plugin-a11y</code>が依存に追加されたので、アップデートする際は追加でインストールする必要があります。</p>

<ul>
<li><a href="https://github.com/evcohen/eslint-plugin-jsx-a11y">https://github.com/evcohen/eslint-plugin-jsx-a11y</a></li>
</ul>


<h2>5 Open Source React Native Projects To Learn From (React Native Blog)</h2>

<ul>
<li><a href="https://medium.com/@bilalbudhani/5-open-source-react-native-projects-to-learn-from-fb7e5cfe29f2">https://medium.com/@bilalbudhani/5-open-source-react-native-projects-to-learn-from-fb7e5cfe29f2</a></li>
</ul>


<p>ソースが公開されている5つのReactNativeのアプリが紹介されています。</p>

<h2>React Hot Loader 3.0 alpha demo (Library)</h2>

<ul>
<li><a href="https://github.com/gaearon/react-hot-loader/pull/240">https://github.com/gaearon/react-hot-loader/pull/240</a></li>
</ul>


<p>React Hot Loaderの3.0のalpha版がリリースされています。2は飛ばして一気に3になったようです。
3.0のデモは下記で紹介されていますので使っている人は確認してみるといいと思います。</p>

<ul>
<li><a href="https://github.com/gaearon/react-hot-boilerplate/pull/61">https://github.com/gaearon/react-hot-boilerplate/pull/61</a></li>
</ul>


<p>個人的には使っていないので詳細はわからないですが、Stateless ComponentsやHOC辺りのサポートや設定周りが改善されたようです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React Links vol.1 4/6〜4/14]]></title>
    <link href="http://blog.koba04.com/post/2016/04/14/reactjs-links-vol1/"/>
    <updated>2016-04-14T13:17:31+09:00</updated>
    <id>http://blog.koba04.com/post/2016/04/14/reactjs-links-vol1</id>
    <content type="html"><![CDATA[<p>これはReactに関する記事や気になるissueなどのリンクを紹介する記事です。</p>

<p>今週はF8があったのでReact Native関連の記事が多くありました。</p>

<!-- more -->


<h2>React v15</h2>

<ul>
<li><a href="http://facebook.github.io/react/blog/2016/04/07/react-v15.html">http://facebook.github.io/react/blog/2016/04/07/react-v15.html</a></li>
<li><a href="https://facebook.github.io/react/blog/2016/04/08/react-v15.0.1.html">https://facebook.github.io/react/blog/2016/04/08/react-v15.0.1.html</a></li>
</ul>


<p>React v15がリリースされました。バグがあったのですぐに15.0.1がリリースされています。インストールする際には15.0.1を使用してください。</p>

<p>細かいfeatureについてはブログ書いたのでそちらをみてください</p>

<ul>
<li><a href="http://blog.koba04.com/post/2016/03/09/react-js-v15-changes/">http://blog.koba04.com/post/2016/03/09/react-js-v15-changes/</a></li>
</ul>


<h2>React Native: A year in review</h2>

<ul>
<li><a href="https://code.facebook.com/posts/597378980427792/react-native-a-year-in-review/">https://code.facebook.com/posts/597378980427792/react-native-a-year-in-review/</a></li>
</ul>


<p>React Nativeが2013年の夏に社内の(?)hackathonで誕生してから、30,000以上のstarをgithubで得るようになるまでのStoryが書かれています。
&ldquo;The React Native team has grown from around 10 to around 20 engineers in the past year"や"we are 1 percent finished. "とあるように、今後も力を入れていくことがわかります。
Facebookのエンジニア以外からのcommitも30%くらいあって、Facebook以外でも使われていることがわかります。</p>

<p>また、facebookがreact-nativeのリポジトリをどのように管理しているのかや、たくさんのissueやPRを処理するために作ったmention-botなどについても書かれていて、巨大なOSSをgithubでどう管理するかという点でも面白いです。</p>

<p><a href="https://github.com/facebook/mention-bot">https://github.com/facebook/mention-bot</a></p>

<h2>Building the F8 2016 App</h2>

<ul>
<li><a href="http://makeitopen.com/">http://makeitopen.com/</a></li>
</ul>


<p>ReactNativeを使ってF8のiOSとAndroidのアプリを作った際のことを、チュートリアルとして紹介しています。
どのような構成にするのかを検討して、マルチプラットフォーム対応をどうするか、データ管理をどうするか、テストをどうするかなどが書かれていてとても参考になります。</p>

<p>React使っている人は一度見てみるといいんじゃないかと思います。</p>

<p>ReactNative + Flow + Redux + Jestな構成でサーバーサイドにはOSSのParse Serverを使っているようです。
エディターはNuclideだそうです。</p>

<p>アプリのソースコードもgithubで公開されています。</p>

<ul>
<li><a href="https://github.com/fbsamples/f8app">https://github.com/fbsamples/f8app</a></li>
</ul>


<h2>React Native on the Universal Windows Platform</h2>

<ul>
<li><a href="https://blogs.windows.com/buildingapps/2016/04/13/react-native-on-the-universal-windows-platform/">https://blogs.windows.com/buildingapps/2016/04/13/react-native-on-the-universal-windows-platform/</a></li>
</ul>


<p>MicroSoftがUniversal Windows Platform (UWP)対応をReactNativeに追加することが書かれています。
これにより、WindowsのPCがモバイルだけでなく、Xbox OneやHoloLensのためのアプリをReactNativeで作れるようになります。
記事では、F8のアプリをWindows 10 mobileとDesktop向けに作ったことが紹介されています。</p>

<p>JavaScriptのランタイムにはChakraが使われているみたいです。</p>

<p>また、VSCodeのReactNative拡張やReactNativeを使ったWindowsアプリに対するCodePush対応などを行っているようです。</p>

<ul>
<li><a href="http://microsoft.github.io/code-push/articles/ReactNativeWindows.html">http://microsoft.github.io/code-push/articles/ReactNativeWindows.html</a></li>
</ul>


<p>現在はforkしたrepositoryになっていますが、将来的にはReactNative本体と同期が取れるようにうまくやっていくようです。</p>

<p><a href="https://github.com/ReactWindows/react-native">https://github.com/ReactWindows/react-native</a></p>

<h2>core note 4/7</h2>

<ul>
<li><a href="https://github.com/reactjs/core-notes/blob/master/2016-04/april-7.md">https://github.com/reactjs/core-notes/blob/master/2016-04/april-7.md</a></li>
</ul>


<p>Reactのcoreチームのmeeting noteが公開されています。
以前はあったものの途中で削除されたBrowser Testingについて言及されているのは注目です。</p>

<p>その他では、<em>ReactDOM.render() return value being <del>deprecated</del> legacy</em> (<a href="https://github.com/facebook/react/pull/6400">#6400</a>) も注目です。
内部的なアルゴリズムの見直しをするために、ReactDOM.renderが将来的に戻り値を返さなくなります。
戻り値を使いたい場合は、Refsを指定して取得することになりそうです。</p>

<p>また、<em>Sebastian is moving some files from React Native to React</em> (<a href="https://github.com/facebook/react/pull/6338">#6338</a>)としてReactNativeのrenderer周りをreactのrepositoryに持ってきて、<code>react-native-renderer</code>として別パッケージにすることも予定されています。
さらに<code>react-dom</code>から<code>react-dom-renderer</code>も切り離すことを検討されています。</p>

<p>これによってカスタムrendererを作る時のI/Fが整備されて、わかりやすくなるといいなと思います。
Windows対応もあったりでこの辺りを整理する優先度は高そうです。</p>

<h2>Improve React performance with Babel</h2>

<ul>
<li><a href="https://medium.com/doctolib-engineering/improve-react-performance-with-babel-16f1becfaa25">https://medium.com/doctolib-engineering/improve-react-performance-with-babel-16f1becfaa25</a></li>
</ul>


<p>productionビルドやBabelの最適化を使った場合のパフォーマンスについてのエントリーです。当たり前ですが、developmentビルドとproductionビルドのパフォーマンスの違いが目立っています。
Babelを使った最適化の場合でも数%の向上が見られますが、アプリケーションによるので利用する際は計測してみて導入することをおすすめします。</p>

<h2>unofficial React Router docs</h2>

<ul>
<li><a href="http://knowbody.github.io/react-router-docs/">http://knowbody.github.io/react-router-docs/</a></li>
</ul>


<p><a href="https://github.com/knowbody">knowbody</a>さんによる非公式なReact Routerのドキュメントです。WIPですが、公式を読んでよくわからなかった人は確認してみるといいかもしれません。</p>

<h2>React Router is dead. Long live rrtr.</h2>

<p><strong>下のエントリーは現在は削除されています。</strong></p>

<ul>
<li><del><a href="https://medium.com/@taion/react-router-is-dead-long-live-rrtr-d229ca30e318#.vd0qjkccc">https://medium.com/@taion/react-router-is-dead-long-live-rrtr-d229ca30e318#.vd0qjkccc</a></del></li>
</ul>


<p>React Routerでここ数ヶ月中心的にcontributeしていた<a href="https://github.com/taion">taion</a>さんがリリースのサイクルの遅さやプロセスに不満を抱いてforkして<a href="https://github.com/taion/rrtr">rrtr</a>を作ったことを表明したエントリーです。</p>

<p>それに対して、React Routerのオーナーである<a href="https://github.com/ryanflorence">ryanflorence</a>さんもgistでリアクションしています。</p>

<ul>
<li><del><a href="https://gist.github.com/ryanflorence/08a056374e24a7cda3c459e3d7d63e6e">https://gist.github.com/ryanflorence/08a056374e24a7cda3c459e3d7d63e6e</a></del> (<strong>これも削除済み</strong>)</li>
</ul>


<p>で下の通り、結局丸く収まりました。</p>

<ul>
<li><a href="https://medium.com/rackt-and-roll/rrtr-is-dead-long-live-react-router-ce982f6f1c10">https://medium.com/rackt-and-roll/rrtr-is-dead-long-live-react-router-ce982f6f1c10</a></li>
</ul>


<p>結果的に、PRをmergeするプロセスや定期的なリリースなど、プロジェクトの運営方針が行われました。</p>

<p>ちなみにtaionさんはhistoryと組み合わせてscroll位置の復元などをサポートするscroll-behaviorというライブラリーも公開しています。</p>

<ul>
<li><a href="https://github.com/taion/scroll-behavior">https://github.com/taion/scroll-behavior</a></li>
</ul>


<h2>crysislinux/chrome-react-perf</h2>

<ul>
<li><a href="https://github.com/crysislinux/chrome-react-perf">https://github.com/crysislinux/chrome-react-perf</a></li>
</ul>


<p>Perfによる計測をChrome Developer Toolsで行うことができるライブラリーです。
カジュアルに計測が出来そうなのでよさそうです。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React.js v15.0 changes]]></title>
    <link href="http://blog.koba04.com/post/2016/03/09/react-js-v15-changes/"/>
    <updated>2016-03-09T13:07:52+09:00</updated>
    <id>http://blog.koba04.com/post/2016/03/09/react-js-v15-changes</id>
    <content type="html"><![CDATA[<p><strong>v15.0.0がリリースされました(2016/04/08)</strong></p>

<hr />

<p><strong>RC2が出たので追記</strong></p>

<p><strong>RC2</strong> ではIE、Edgeでマークアップの構造によって一部のテキストが表示されないバグ(<a href="https://github.com/facebook/react/issues/6246">#6246</a>)とSVGに関する変更がrevertされました。</p>

<hr />

<p>React.js v15.0がリリースされたので変更内容などを整理したいと思います。</p>

<ul>
<li><a href="https://facebook.github.io/react/blog/2016/03/07/react-v15-rc1.html">https://facebook.github.io/react/blog/2016/03/07/react-v15-rc1.html</a></li>
<li><a href="http://facebook.github.io/react/blog/2016/03/16/react-v15-rc2.html">http://facebook.github.io/react/blog/2016/03/16/react-v15-rc2.html</a></li>
<li><a href="http://facebook.github.io/react/blog/2016/04/07/react-v15.html">http://facebook.github.io/react/blog/2016/04/07/react-v15.html</a></li>
</ul>


<p><code>
% npm install --save react@15.0.0 react-dom@15.0.0
</code></p>

<p>今回の一番大きな変更はバージョン番号かなと思います。</p>

<p>0.14から15.0に。</p>

<p>0.x系だとproduction readyではないと思われることから一気に15.0になりましたが0.がなくなっただけで大きな変化があるわけでもないです。
なぜ1.0ではないのかというと1.0というバージョン番号は特別意味のあるものとして扱われるので、そうではなくてすでにproduction readyでありsemverに従っているということを明確にするために0.を取って15.0になりました。</p>

<p><a href="https://facebook.github.io/react/blog/2016/02/19/new-versioning-scheme.html">https://facebook.github.io/react/blog/2016/02/19/new-versioning-scheme.html</a></p>

<p>ちなみにこれまでもminor version(0.13 &ndash;> 0.14)などでは破壊的な変更がありましたがpatch version(0.14.1 &ndash;> 0.14.2)などは基本的には破壊的な変更はなかったのでバージョンアップのサイクルなどが変わることはないと思います。
（patch versionの更新でUndocumentedなfeatureで破壊的な変更が入ることはありましたが&hellip;）</p>

<p>これまでも破壊的な変更をする際は基本的には前のバージョンでwarningを入れてから更新するので、今回もすでに0.14.7を使っていて特にwarningなどが出力されていないのであれば問題なく15.0にアップデートできると思います。</p>

<!-- more -->


<p>ちなみにIE8のサポートについてはまだIE8対応のコードは削除されていないので動作するはずですが、今後はIE8のためだけのバグFixなどは行わないというステータスです。</p>

<p><a href="https://facebook.github.io/react/blog/2016/01/12/discontinuing-ie8-support.html">https://facebook.github.io/react/blog/2016/01/12/discontinuing-ie8-support.html</a></p>

<h2>Major changes</h2>

<h3>document.createElement is in and data-reactid is out</h3>

<p>これまではReactで構築した全てのDOMに対して<code>data-reactid</code>という属性が付与されていましたがそれが付与されなくなりました。すっきりしていいですね。
ReactDOM.renderを行ったルートの要素には<code>data-reactroot</code>という属性が付与されます。</p>

<p>またこれまでは多くの場合で<code>document.createElement</code>を使うよりも高速であるという理由から初期マウント時にはHTML文字列を生成してinnerHTMLで流し込んでいましたが、ブラウザーの改善などにより必ずしもそうとも言えなくなってきたので<code>document.createElement</code>を使って作成するように変更されました。</p>

<p><code>data-reactid</code>がなぜ必要だったのかはReactのイベントの仕組みに関係しています。
ReactではイベントハンドリングはそれぞれのReactElementと対応付けられたDOM要素にイベントリスナーを登録してハンドリングするのではなく、<code>ReactDOM.render</code>で指定したルートのDOM要素だけにイベントリスナーを登録してそこで全てのイベントをハンドリングしています。
ルートで受け取ったイベントがどのReactElementと対応付けられたDOMで発生したのかを判定するために<code>data-reactid</code>が使用されていました。</p>

<p>イベントは頻繁に発生するため内部ではキャッシュなどを駆使して高速化が図られていたのですがそれによるバグも多く、今回HTML文字列ではなくDOM要素を作成するようになり、DOM要素を保持しておけばいいので<code>data-reactid</code>を使ったマッピング情報を保持しておく必要がなくなりました。</p>

<p>ちなみに<code>ReactDOM.renderToString</code>を使って生成したHTML文字列には変わらず<code>data-reactid</code>が付与されています。</p>

<h3>No more extra <code>&lt;span&gt;</code>s</h3>

<p><code>{name}</code>などのように変数を文字列として埋め込んだ際にこれまでは差分更新のために<code>span</code>タグで囲まれていたのがcomment nodeに変更されました。</p>

<ul>
<li>v0.14</li>
</ul>


<p>```html</p>

<div id="app">
<div data-reactid=".0">
<span data-reactid=".0.0">Hello </span>
<span data-reactid=".0.1">React</span>
</div>
</div>


<p>```</p>

<ul>
<li>v15</li>
</ul>


<p>```html</p>

<div id="app">
<div data-reactroot="">
<!-- react-text: 2 -->Hello <!-- /react-text -->
<!-- react-text: 3 -->React<!-- /react-text -->
</div>
</div>


<p>```</p>

<p>この変更はマークアップ構造の変更を生むので更新する際には注意が必要です。
特にCSS周りやテストでspanが挿入されることに依存したコードを書いていると壊れます。</p>

<p>元々が意図しないマークアップが挿入されていたのでそれがなくなってよかったんじゃないでしょうか。</p>

<h3>Rendering null now uses comment nodes</h3>

<p>renderメソッドでnullを返した場合に、これまでは<code>&lt;noscript&gt;</code>タグがrenderされていましたがcomment nodeに変更されました。
この変更もマークアップ構造の変更を生むので特に<code>:nth-child</code>などのセレクターを使っている場合には注意が必要です。</p>

<p>また下記のエントリーにもあるように無駄に<code>&lt;noscript&gt;</code>タグが更新されていたような場合に対するパフォーマンスの改善となります。</p>

<p><a href="http://benchling.engineering/deep-dive-react-perf-debugging/">http://benchling.engineering/deep-dive-react-perf-debugging/</a></p>

<h3>Improved SVG support</h3>

<p><strong>[更新]RC2でrevertされました</strong></p>

<p><del>全てのSVGタグがサポートされるようになりました。一般的ではないタグは<code>React.DOM</code>のヘルパーとしては提供されていませんが、<code>React.createElement</code>で全てのSVGタグを作成できます。</del>
<del>全てのSVGタグはキャメルケースやハイフンなどそのままの指定で作成できます。</del>
<del><code>gradientTransform</code>は<code>gradientTransform</code>のままで<code>clip-path</code>は<code>clip-path</code>のまま指定します。</del></p>

<p><del>ちなみにクラスを指定する場合は<code>className</code>ではなくて、<code>class</code>で指定します。custom elementsと同じです。</del>
<del>それに関するissueはこちら。</del></p>

<p><del> <a href="https://github.com/facebook/react/issues/6211">https://github.com/facebook/react/issues/6211</a> </del></p>

<p>このSVGに対する挙動の変更はcustom elementsの挙動と同様であったのですが、HTMLElementとの整合性(<code>class</code> &ndash;> <code>className</code>など)がなくなってしまうことが問題だということでrevertされました。
なのでサポートされていないsvgの要素や属性があれば引き続きPRして反映する必要があります。こんな感じで。(<a href="https://github.com/facebook/react/pull/6267">#6267</a>)</p>

<p>将来的にはSVGもHTMLも普段SVGやHTMLと同じようにclassはclassのままで指定できるようになるのではないかなと思います。具体的な予定は示されていませんが&hellip;。</p>

<h2>Breaking changes</h2>

<p>v15で最も大きなBreaking changeは上に書いたspanタグを使わなくなったことによるマークアップ構造の変化です。</p>

<p>その他では、v0.14でwaringsを出力していたDeprecatedなAPIが完全に削除されました。</p>

<ul>
<li><p>Reactのパッケージから<code>findDOMNode</code>, <code>render</code>, <code>renderToString</code>, <code>renderToStaticMarkup</code>, <code>unmountComponentAtNode</code>が削除されました。代わりにReactDOMのパッケージにある同名のAPIを使います。</p></li>
<li><p>Addonとして提供されていた<code>batchedUpdates</code>と<code>cloneWithProps</code>が削除されました。</p></li>
<li><p><code>setProps</code>, <code>replaceProps</code>, <code>getDOMNode</code>のAPIが削除されました。</p></li>
</ul>


<h2>New deprecations, introduced with a warning</h2>

<p><code>LinkedStateMixin</code>と<code>valueLink</code>はほとんど使われておらず、v16で廃止するためのwarningを追加されます。</p>

<p><a href="https://facebook.github.io/react/docs/two-way-binding-helpers.html">https://facebook.github.io/react/docs/two-way-binding-helpers.html</a></p>

<p>必要な場合は下記のパッケージを利用してください。</p>

<p><a href="https://www.npmjs.com/package/react-linked-input">https://www.npmjs.com/package/react-linked-input</a></p>

<h2>New helpful warnings</h2>

<ul>
<li>developmentビルド(<code>NODE_ENV</code>が<code>production</code>でない)にも関わらずminifiedされている場合はproductionビルドを使うようにwarningが出ます。

<ul>
<li>Reactの中のコードを見たことがある人であればproductionビルドにする必要性がわかるはず&hellip;。developmentビルドには大量のデバッグやwarning用のコードが含まれています。</li>
</ul>
</li>
<li>styleのwidthやmarginに数値を渡すと自動で単位(px)を付与してくれますが、その際に数値を文字列として渡しているとwarningが出ます。将来のバージョンでは文字列の場合は単位が自動で付与されなくなります。

<ul>
<li><code>&lt;div style={ {width: 10} }&gt;</code>はOK、<code>&lt;div style={ {width: "10"} }&gt;</code>はwarningが出ます。</li>
</ul>
</li>
<li>SyntheticEventに追加でpropertyをセットしようとしたり、すでに解放されているのにアクセスしようとするとwarningが出力されます。

<ul>
<li>追加でpropertyをセットした場合にwarningが出るのはES2015のProxiesがサポートされている環境のみです。ちなみに自分が実装しました。</li>
</ul>
</li>
<li>ReactElementの<code>ref</code>と<code>key</code>のPropにアクセスしようとするとwarningが出力されます。これらはReact自体が使うためのPropでkeyで使った値が必要な場合は別途Propとして設定する必要があります。</li>
<li>DOM ElementのPropに対して、<code>onClick</code>を<code>onclick</code>のように大文字・小文字の指定が間違っている場合にはwarningが出力されるようになりました。</li>
</ul>


<h2>Notable bug fixes</h2>

<ul>
<li>幾つかのメモリリークが修正されています。</li>
</ul>


<hr />

<p>SyntheticEventでのメモリリークについては自分が修正したので紹介しておくとSyntheticEventの<code>target</code>属性が正しく解放されるようになりました。</p>

<p>SyntheticEventはPoolingされており、イベントハンドラーの処理が終了すると初期化されPoolに戻るのですが一番よく使う<code>target</code>属性だけ解放されていませんでした。
したがって、下記のようなコードはv0.14では動作していましたがv15では動作しません。</p>

<p>```js
const Component = () => (</p>

<pre><code>&lt;div onClick={e =&gt; {
  setTimeout(() =&gt; console.log(e.target)); // &lt;div&gt;click&lt;/div&gt;
}}&gt;
  click
&lt;/div&gt;
</code></pre>

<p>);
```</p>

<p>これは<code>onClick</code>が実行された時点でSyntheticEvent(<code>e</code>)が初期化されており、setTimeoutのコールバック実行時にはすでにtargetの値が初期化(null)されているためです。
上記の場合、<code>target</code>をローカル変数として保持するか<code>e.persist()</code>を使って保持する必要があります。</p>

<p>SyntheticEventがPoolingされているのは大量のイベントオブジェクトを作成することで発生するGCを避けるなどパフォーマンス上の理由からなのですが、モダンなブラウザーではもう必要ないのではないかということでPoolingをやめることが検討されています。</p>

<p>SyntheticEvent周りは自分が追加したProxyを使ったコードなどかなり混沌としてきているのでPoolingやめてリファクタリングするのはとてもいいと思います。やりたい&hellip;。</p>

<p><a href="https://github.com/facebook/react/issues/6190">https://github.com/facebook/react/issues/6190</a></p>

<hr />

<ul>
<li>IE10, 11などでのイベントの扱いが改善されています。</li>
<li><code>cite</code>と<code>profile</code>の属性がサポートされました。</li>
<li><code>onAnimationStart</code>, <code>onAnimationEnd</code>, <code>onAnimationIteration</code>, <code>onTransitionEnd</code>, <code>onInvalid</code>のイベントがサポートされました。また<code>object</code>要素に<code>onLoad</code>イベントが追加されました。</li>
<li>shallowCompareなどのいくつかの場所で<code>Object.is</code>による比較が行われるようになりました(実際にはpolyfill)。これにより、<code>+0 !== -0</code>となったり<code>NaN === NaN</code>となります。

<ul>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/is</a></li>
</ul>
</li>
<li><p>ReactDOMがデフォルトではpropertyとしてではなくattributeとして扱うようになります。これによるEdge caseなバグが修正されました。また属性値が<code>null</code>の場合に属性が完全に削除されるようになりました。これによりブラウザーがデフォルト値を設定しないようになります。</p></li>
<li><p>あとblogにはありませんでしたが、Stateless Componentsが<code>null</code>を返せるようになったのは地味に嬉しいですね！</p></li>
</ul>


<h2>Regression?</h2>

<ul>
<li>15.0.0-rc.1では<code>onTouchTap</code>が動作していないようなので使っている人は注意した方がよさそうです。

<ul>
<li><a href="https://github.com/facebook/react/issues/6221">https://github.com/facebook/react/issues/6221</a></li>
</ul>
</li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React.js meetup #3を開催しました]]></title>
    <link href="http://blog.koba04.com/post/2016/03/07/reactjs-meetup3/"/>
    <updated>2016-03-07T17:08:38+09:00</updated>
    <id>http://blog.koba04.com/post/2016/03/07/reactjs-meetup3</id>
    <content type="html"><![CDATA[<p>前回開催したのが9月だったみたいなので半年くらい経ちましたがReact.js meetup #3を開催しました。</p>

<ul>
<li><a href="http://reactjs-meetup.connpass.com/event/26229/">http://reactjs-meetup.connpass.com/event/26229/</a></li>
</ul>


<p>今回はサイボウズさんに会場を提供して頂き開催することができました。
サイボウズの皆様、参加者の皆様、発表者の皆様ありがとうございました！！</p>

<p>connpassの管理画面によると<strong>75/80人</strong>の方が参加してくださいました。感謝！</p>

<p><img src="/images/reactjs-meetup3.jpg" title="&lsquo;React.js meetup #3&rsquo;" ></p>

<!-- more -->


<h2>開催の経緯</h2>

<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr"><a href="https://twitter.com/koba04">@koba04</a> hey! I&#39;ll be in Tokyo in February. Are there any ReactJS or general JavaScript meetups happening during that time?</p>&mdash; Christoph Pojer (@cpojer) <a href="https://twitter.com/cpojer/status/691698537306796032">January 25, 2016</a></blockquote>


<script async src="http://blog.koba04.com//platform.twitter.com/widgets.js" charset="utf-8"></script>


<p>というmentionがきっかけで急遽の開催となりました。前回と全く同じような経緯です。</p>

<p><a href="http://blog.koba04.com/post/2015/09/09/reactjs-meetup2/">http://blog.koba04.com/post/2015/09/09/reactjs-meetup2/</a></p>

<h2>準備など</h2>

<p><a href="https://twitter.com/yosuke_furukawa">@yusuke_furukawa</a>会長と相談しつつ、サイボウズさんに会場が決まってからは当日の準備や受付、懇親会の手配までサイボウズの方々にお任せしてしまって本当に助かりました！
というわけで今回も自分はあまり何もしてないのですがイベントの構成を考えたりしていました。</p>

<p>募集に関しては募集開始日に埋まることは予想していたのですが、2分持たずに埋まることまでは想定していなかったので次回の募集方法については考えようかなと思っています。
（先着・抽選50%ずつなど）</p>

<h2>Talk</h2>

<p>Talkに関しては、<a href="https://twitter.com/cpojer">@cpojer</a>さんのTalkは事前に相談して得意分野であるというjscodeshitについてのTalkをお願いしてReactなどについてはQ&amp;Aでという形になりました。
Q&amp;Aについては<a href="https://twitter.com/yando">@yando</a>さんが通訳してくださったので本当に助かりました。ありがとうございました！！</p>

<p>今回のTalkはJSConf EU 2015でのTalkがベースになっているので興味のある方はそちらも参照してください。</p>

<p><a href="https://www.youtube.com/watch?v=d0pOgY8__JM">https://www.youtube.com/watch?v=d0pOgY8__JM</a></p>

<p>その他のTalkについても自分が聞きたいなぁと思った内容について個別にTalkをお願いしました。
どのTalkも15分では短いくらいで面白かったです。</p>

<p>LTもどれも面白かったですね。</p>

<p>全部のTalkの資料が公開されているわけではないですが、下記のブログやtogetterによるまとめを見てください！</p>

<ul>
<li><a href="http://blog.cybozu.io/entry/2016/03/04/080000">http://blog.cybozu.io/entry/2016/03/04/080000</a></li>
<li><a href="http://togetter.com/li/942145">http://togetter.com/li/942145</a></li>
</ul>


<h2>参加者</h2>

<p>挙手でアンケートを取ったのですが、</p>

<ul>
<li>Reactを使っている人 &hellip; ほとんど全員</li>
<li>仕事でReact使っているという人 &hellip; 半分くらい</li>
<li>Redux使っている人 &hellip; 半分くらい</li>
<li>Facebook Flux使っている人 &hellip; 1割くらい</li>
<li>GraphQL、Relay使っている人 &hellip; 1人？</li>
<li>ReactNative使っている人 &hellip; 1人？</li>
</ul>


<p>みたいな感じでした。
GraphQL、Relay、ReactNativeなんかは英語の記事ではそこそこ見るのですがやはり導入のハードルが高いので実際に踏み込んでいる人はそんなに多くなさそうです。</p>

<p>ReactNativeはGitHubを見てる限り今も活発にメンテナンスされていて、React.js Conf 2016でもTalkが多かったので今後どうなるのかは注目しています。</p>

<h2>次回&hellip;?</h2>

<p>次回はなんとなく6月の頭にあるReact Europe後くらいがいいかなと思っていますが、何か話したいネタがあったり聞きたいテーマなどあれば教えてもらえるとそれまでに開催するかもしれないのでよろしくお願いします！</p>

<p>Reactの勉強会が少ない気がするという声も聞いたのでやりたい人がいたら是非やるといいんじゃないかなと思います！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[React.js v0.14 changes]]></title>
    <link href="http://blog.koba04.com/post/2015/09/22/react-js-v014-changes/"/>
    <updated>2015-09-22T00:00:00+09:00</updated>
    <id>http://blog.koba04.com/post/2015/09/22/react-js-v014-changes</id>
    <content type="html"><![CDATA[<p>React v0.14のRC版が出たので紹介したいと思います。
<a href="http://facebook.github.io/react/blog/2015/09/10/react-v0.14-rc1.html">http://facebook.github.io/react/blog/2015/09/10/react-v0.14-rc1.html</a></p>

<p>インストールはnpmからバージョン指定でインストールするかscriptを読み込むことで試すことが出来ます。
<code>react-dom</code>が何なのかは後ほど説明します。</p>

<p><code>
npm install react@0.14.0-rc1
npm install react-dom@0.14.0-rc1
</code></p>

<p>or</p>

<p>```html</p>

<script src="https://fb.me/react-0.14.0-rc1.js"></script>


<!--  https://fb.me/react-with-addons-0.14.0-rc1.js -->


<script src="https://fb.me/react-dom-0.14.0-rc1.js"></script>


<p>```</p>

<!-- more -->


<h2>Major changes</h2>

<h3>ReactとReactDOMのパッケージが分割されました</h3>

<p><code>react-native</code>や<code>react-canvas</code>など、DOM以外の環境で使われるようになってくる中で、Reactのコアの部分とDOMに関わる部分がパッケージとして分割されるようになりました。</p>

<p>Reactのパッケージには、<code>React.createElement</code>、<code>React.createClass</code>、<code>React.Component</code>、<code>React.PropTypes</code>、<code>React.Children</code>が含まれています。</p>

<p>ReactDOMのパッケージには、<code>ReactDOM.render</code>、<code>ReactDOM.unmountComponentAtNode</code>、<code>ReactDOM.findDOMNod</code>が含まれています。
また、ReactDOMのパッケージには<code>react-dom/server</code>として<code>ReactDOMServer.renderToString</code>と<code>ReactDOMServer.renderToStaticMarkup</code>が含まれています。</p>

<p>```js
import React from &lsquo;react&rsquo;;
import ReactDOM from &lsquo;react-dom&rsquo;;</p>

<p>class App extends React.Component {
  render() [</p>

<pre><code>return &lt;div&gt;Hello&lt;/div&gt;
</code></pre>

<p>  ]
}</p>

<p>ReactDOM.render(<App />, document.getElementById(&lsquo;app&rsquo;));</p>

<p>// サーバーサイド
import ReactDOMServer from &lsquo;react-dom/server&rsquo;;
const html  = ReactDOMServer.renderToString(<App />);
```</p>

<p>scriptタグで読み込んで利用する場合は、ReactとReactDOMそれぞれを読み込んで利用する必要があります。</p>

<p>```html</p>

<script src="https://fb.me/react-0.14.0-rc1.js"></script>


<script src="https://fb.me/react-dom-0.14.0-rc1.js"></script>


<div id="app"></div>


<script>
var App = React.createClass({
    render: function() {
        return React.createElement('div', {}, 'hello', 'world');
    }
});

ReactDOM.render(React.createElement(App), document.getElementById('app'));
</script>


<p>```</p>

<p>codemodも提供されているので既存のコードを一括で変換したい場合は使ってみるといいかもしれません。
<a href="https://github.com/facebook/react/blob/master/packages/react-codemod/README.md">https://github.com/facebook/react/blob/master/packages/react-codemod/README.md</a></p>

<h4>Addons</h4>

<p>また、Addonもそれぞれ個別のパッケージに分割されたので必要に応じてnpmでインストールするようになりました。</p>

<ul>
<li>react-addons-clone-with-props</li>
<li>react-addons-create-fragment</li>
<li>react-addons-css-transition-group</li>
<li>react-addons-linked-state-mixin</li>
<li>react-addons-perf</li>
<li>react-addons-pure-render-mixin</li>
<li>react-addons-shallow-compare</li>
<li>react-addons-test-utils</li>
<li>react-addons-transition-group</li>
<li>react-addons-update</li>
</ul>


<p>これによって、1つのAddonを使いたい時にその他全部のAddonがbundleされることがなくなりました。
scriptタグで読み込むための<code>react-with-addons</code>のJSにはこれまで通り全てのAddonが含まれています。</p>

<p>また、<code>batched_updates</code>としてあったReactのイベントやライフサイクル以外でもバッチによる一括アップデートを行えるAddonは<code>ReactDOM.unstable_batchedUpdates</code>に移動しました。</p>

<p><code>js
let count = 0;
cost component = ReactDOM.render(&lt;App /&gt;, document.getElementById('app'));
ReactDOM.unstable_batchedUpdates(() =&gt; {
  component.setState({count: ++count});
  component.setState({count: ++count});
});
</code></p>

<p>ちなみにunstable_batchedUpdatesという名前になっているけど今後どうする予定なのかを聞いたところ、全ての更新をバッチ更新にしたいということだったので最終的には不必要にしたいようです。</p>

<p><strong>ReactとReactDOMやAddon</strong> のパッケージは意図しない挙動を避けるために同じバージョンを使うことが推奨されています。</p>

<h3>DOMComponentに対するrefによる参照でDOM Nodeが取得出来るようになりました</h3>

<p>これまでDOM nodeを取得したい場合には<code>React.findDOMNode(this.refs.div)</code> のようにする必要がありましたが、<code>this.refs.div</code>で直接DOM nodeを取得することが出来るようになりました。
findDOMNodeの呼び出しを書かなくてもいいというだけですが簡単になりました。
それと同時にrefでのComponentの参照はなるべくDOM Component以外では使わないようにしておかないと混乱を招きそうではあります。</p>

<p>また、<code>ReactDOM.render(&lt;div&gt;foo&lt;/div&gt;)</code> とした場合の返り値もDOM Nodeになります。
ReactDOM.findDOMNodeは以降もComposite Componentに対するDOM nodeを取得する場合に利用することが出来ます。</p>

<h3>Stateless Components</h3>

<p>Propsだけに依存するような状態を持たないComponentを定義するための新しい方法が追加されました。</p>

<p>```js
function Hello(props) {
  return <div>Hello {props.name}
}</p>

<p>// Arrow Functions
const Hello = (props) => {
  return <div>Hello {props.name}</div>;
};</p>

<p>// Arror Functions and Destructuring Assignment
const Hello = ({name}) => {
  return <div>Hello {name}</div>;
}
```</p>

<p>また、PropTypesやdefaultPropsも定義することが出来ます。</p>

<p><code>js
function Hello(props) {
  return &lt;div&gt;Hello {props.name}
}
Hello.propTypes = {
  name: React.PropTypes.string
};
Hello.defaultProps = {
  name: 'World'
};
</code></p>

<p>あとContextも。</p>

<p><code>js
function Hello(props, context) {
  return &lt;div&gt;{context.version}&lt;/div&gt;
}
Hello.contextTypes = {
  version: React.PropTypes.number
}
</code></p>

<p>v0.14では最低限の実装のみになっていますが、以降のバージョンではStateless Componentsで書いておくことでパフォーマンス最適化の恩恵が受けられるようになる予定です。
v0.14以降ではStateless ComponentsがComponent定義の第一の選択肢になっていきそうです。</p>

<h3>react-toolsは廃止されました</h3>

<p>これは以前にもブログで紹介されていましたが、<code>react-tools</code>は非推奨になります(もう更新されない)。代わりにBabelを利用しましょう。</p>

<p><a href="http://facebook.github.io/react/blog/2015/06/12/deprecating-jstransform-and-react-tools.html">http://facebook.github.io/react/blog/2015/06/12/deprecating-jstransform-and-react-tools.html</a></p>

<ul>
<li>jsxコマンドは<code>babel</code>コマンドになります。</li>
<li>browserifyのtransformであるreactifyは<code>babelify</code>になります。</li>
<li>webpackのjsx-loaderは<code>babel-loader</code>になります</li>
<li>Node.jsのサーバー上で動かすときに<code>require('node-jsx').install()</code>としていたものは<code>require('babel/register')</code>になります。</li>
<li>ブラウザでJSXを変換するために使うJSXTransformはbabel-core/browser.jsを読み込んでtypeを<code>text/babel</code>にして使用します。</li>
</ul>


<p>```html</p>

<script src="https://fb.me/react-0.14.0-rc1.js"></script>


<script src="https://fb.me/react-dom-0.14.0-rc1.js"></script>


<script src="node_modules/babel-core/browser.js"></script>


<script type="text/babel">
const Hello = ({name}) => <div>{name}</div>
</script>


<p>```</p>

<p>ちなみにBabelは6.0でTransformが全て外出しになり使う場合はpluginとして読み込みようになることが予定されています。</p>

<p><code>
"plugins": ["preset-es2015", "preset-react"]
</code></p>

<h3>Babelによるコンパイル最適化が実施されるようになりました</h3>

<p>Babel5.8.23以降のバージョンを利用することで、<code>inlineElements</code>と<code>constantElements</code>を２つの最適化を行うことが出来るようになります。
これらは開発用のwarningやPropTypesによるチェックを無効化するので、productionモードの場合だけで有効にすることが推奨されています。</p>

<p>下記のコードを元に変換内容を確認してみます。</p>

<p>```js
// hello.js
class App extends React.Component {
  render() {</p>

<pre><code>return (
  &lt;div&gt;
    &lt;p&gt;Hello&lt;/p&gt;
    &lt;p&gt;{this.props.name}&lt;/p&gt;
  &lt;/div&gt;
)
</code></pre>

<p>  }
}
```</p>

<p>最適化なし</p>

<p>```js
var App = (function (<em>React$Component) {
  </em>inherits(App, _React$Component);</p>

<p>  function App() {</p>

<pre><code>_classCallCheck(this, App);

_get(Object.getPrototypeOf(App.prototype), "constructor", this).apply(this, arguments);
</code></pre>

<p>  }</p>

<p>  _createClass(App, [{</p>

<pre><code>key: "render",
value: function render() {
  return React.createElement(
    "div",
    null,
    React.createElement(
      "p",
      null,
      "Hello"
    ),
    React.createElement(
      "p",
      null,
      this.props.name
    )
  );
}
</code></pre>

<p>  }]);</p>

<p>  return App;
})(React.Component);
```</p>

<h4>inlineElements</h4>

<p>inlineElementsの最適化を行うことでJSXの変換が<code>React.createElement</code>への変換ではなくてただのオブジェクトへの変換となります。</p>

<p><code>
babel --optional optimisation.react.inlineElements test.js
</code></p>

<p>```js
_createClass(App, [{
  key: &ldquo;render&rdquo;,
  value: function render() {</p>

<pre><code>return {
  $$typeof: _typeofReactElement,
  type: "div",
  key: null,
  ref: null,
  props: {
    children: [{
      $$typeof: _typeofReactElement,
      type: "p",
      key: null,
      ref: null,
      props: {
        children: "Hello"
      },
      _owner: null
    }, {
      $$typeof: _typeofReactElement,
      type: "p",
      key: null,
      ref: null,
      props: {
        children: this.props.name
      },
      _owner: null
    }]
  },
  _owner: null
};
</code></pre>

<p>  }
}]);</p>

<p>return App;
})(React.Component);
```</p>

<h4>constantElements</h4>

<p><code>constantElements</code>では、変数の含まれていないReactElementに対する呼び出しを<code>render</code>の外に出すことで不必要な<code>React.createElement</code>の呼び出しを避ける事が出来ます。</p>

<p><code>
babel --optional optimisation.react.constantElements test.js
</code></p>

<p>```js
var _ref = React.createElement(
  &ldquo;p&rdquo;,
  null,
  &ldquo;Hello&rdquo;
);</p>

<p>var App = (function (<em>React$Component) {
  </em>inherits(App, _React$Component);</p>

<p>  function App() {</p>

<pre><code>_classCallCheck(this, App);

_get(Object.getPrototypeOf(App.prototype), "constructor", this).apply(this, arguments);
</code></pre>

<p>  }</p>

<p>  _createClass(App, [{</p>

<pre><code>key: "render",
value: function render() {
  return React.createElement(
    "div",
    null,
    _ref,
    React.createElement(
      "p",
      null,
      this.props.name
    )
  );
}
</code></pre>

<p>  }]);</p>

<p>  return App;
})(React.Component);
```</p>

<h2>Breaking changes</h2>

<p>ここでのBreaking changeはv0.13でwarningとして出力されていたものです。</p>

<ul>
<li>Propsは変更不可として扱われます。開発用のビルドでは<code>Object.freeze</code>されています。Propsの値を変更したい場合は、<code>React.cloneElement</code>によって再生成する必要があります。</li>
<li>childrenにオブジェクト形式で渡すことはサポートされなくなりました。配列に変更するか<code>react-addons-create-fragment</code>を使う必要があります。</li>
<li><code>classSet</code>は削除されたので代わりに<code>classnames</code>のnpm packageを利用してください。</li>
</ul>


<hr />

<p>以下はv0.13でwarningが出力されていなかったものですが、簡単に修正することが出来る変更点です。</p>

<ul>
<li><code>React.initializeTouchEvents</code>は不要になったので削除してください。タッチイベントはデフォルトでサポートされるようになりました。</li>
<li>前述したDOM Componentに対するrefの変更により、<code>TestUtils.findAllInRenderedTree</code>とそれに関連するhelperはComposite Componentのみを受け取るようになりました。(<code>scryRendered〜</code>、<code>findRendered〜</code>系のTestUtils)</li>
</ul>


<h2>Deprecations</h2>

<ul>
<li><code>getDOMNode</code>は非推奨になったので代わりに<code>ReactDOM.findDOMNode</code>を利用してください。前述したとおりDOM Componentの場合は<code>ReactDOM.findDOMNode</code>も不要です。</li>
<li><code>setProps</code>と<code>replaceProps</code>は非推奨になります。代わりに親のComponentから再度<code>ReactDOM.render</code>を呼んでください。</li>
<li>ES6 ClassesによるComponent定義で<code>React.Component</code>を継承することが必須になりました。<a href="http://facebook.github.io/react/blog/2015/01/27/react-v0.13.0-beta-1.html#other-languages">ES3 module pattern</a>はまだ使用することが出来ます。</li>
<li><code>style</code>のPropsを別のrenderと共有し変更することはPropsが変更不可として扱われる影響で非推奨となりました。</li>
<li><code>react-addons-clone-with-props</code>は非推奨になりました。代わりに<code>React.cloneElement</code>を使用してください。<code>cloneElement</code>は<code>cloneWithProps</code>と違い、<code>className</code>と<code>style</code>のmergeは行いません。必要であれば開発者がmergeする必要があります。</li>
<li>信頼性向上のために<code>react-addons-css-transition-group</code>がtransition eventをlistenしなくなりました。そのため<code>transitionEnterTimeout={500}</code>のように明示的にdurationをPropsに指定する必要があります。</li>
</ul>


<h2>Enhancements</h2>

<ul>
<li><code>React.Children.toArray</code>が追加されました。ネストしたchildrenを受け取りkeyを設定したフラットな配列として返すことが出来ます。また<code>React.Children.map</code>もただの配列を返すようになりました。</li>
</ul>


<p>```js
React.Children.toArray(
  [</p>

<pre><code>&lt;div&gt;foo&lt;/div&gt;, &lt;div&gt;bar&lt;/div&gt;,
[&lt;div&gt;baz&lt;/div&gt;]
</code></pre>

<p>  ]
);</p>

<p>// [<div key=".0">foo</div>, <div key=".1">bar</div>, <div key=".2:0">baz</div>]
```</p>

<ul>
<li><p><code>console.warn</code>の代わりに<code>console.error</code>でwarningを出力するようになりました(stack traceを出すため)。<code>console.error</code>として出力されるwarningは将来のバージョンで壊れるような使い方をしていた場合であり、<code>must-fix</code>なエラーとして扱われるべきです。</p></li>
<li><p>可能であればReactDOMがXHTML互換なHTMLを生成するようになりました。</p></li>
<li><p>ReactDOMが<code>capture、challenge、inputMode、is、keyParams、keyType、minLength、summary、wrap</code>といった標準の属性や<code>autoSave、results、security</code>といった非標準な属性をサポートするようになりました。</p></li>
<li><p>SVG属性のサポートが追加されました。</p></li>
</ul>


<p><code>
xlinkActuate、xlinkArcrole、xlinkHref、xlinkRole、xlinkShow、xlinkTitle、xlinkType、xmlBase、xmlLang、xmlSpace
</code></p>

<ul>
<li><p><code>image</code>のSVGタグがサポートされました。</p></li>
<li><p>custome elementsで任意の属性がサポートされるようになりました。</p></li>
<li><p><code>audio</code>と<code>video</code>タグに対するイベントのサポートが追加されました。</p></li>
</ul>


<p><code>
onAbort、onCanPlay、onCanPlayThrough、onDurationChange、onEmptied、onEncrypted、onEnded、onError
onLoadedData、onLoadedMetadata、onLoadStart、onPause、onPlay、onPlaying
onProgress、onRateChange、onSeeked、onSeeking、onStalled、onSuspend、onTimeUpdate、onVolumeChange、onWaiting
</code></p>

<ul>
<li><p><code>shallowCompare</code>のAddonがES6 ClassesのComponentで<code>PureRenderMixn</code>を使うためのマイグレーションのパスとして用意されました。</p></li>
<li><p><code>CSSTransitionGroup</code>が<code>xxx-enter-active</code>のようにclassNameに追加する名前を任意に指定出来るようになりました。</p></li>
</ul>


<p>```js
&lt;ReactCSSTransitionGroup
   transitionName={</p>

<pre><code> enter: 'enter',
 enterActive: 'enterActive',
 leave: 'leave',
 leaveActive: 'leaveActive',
 appear: 'appear',
 appearActive: 'appearActive'
</code></pre>

<p>   }>
   {item}
 </ReactCSSTransitionGroup></p>

<p> &lt;ReactCSSTransitionGroup
   transitionName={</p>

<pre><code> enter: 'enter',
 leave: 'leave',
 appear: 'appear'
</code></pre>

<p>   }>
   {item2}
 </ReactCSSTransitionGroup>
```</p>

<h2>Helpful warnings</h2>

<ul>
<li><p>ReactDOMがHTML構造と不正な要素を受け取った時点でwarningを出力するようになり、更新時に突然エラーとして表面化するよりわかりやすくなりました。</p></li>
<li><p><code>document.body</code>に対して<code>ReactDOM.render</code>使用するとwarningを出力するようになりました。</p></li>
<li><p>複数の異なるReactのオブジェクトを同時に利用しようとした場合に、warningを出力するようになりました。これはnpmとbrowserifyなどを組み合わせている場合に意図せずに起こってしまうことがあります。</p></li>
</ul>


<h2>Bug fixes</h2>

<ul>
<li><p>Mobile Browsersにおいてのクリックイベントのハンドリング(cursor: pointer周り？)にあったバグが修正されました。(特にMobile Safari)</p></li>
<li><p>SVG Elementが多くの場合で正しい名前空間と一緒に描画されるようになりました。</p></li>
<li><p>ReactDOMで複数のchildrenを持ったoptionの場合(<code>&lt;select&gt;&lt;option value={val}&gt;{label}:{val}&lt;/option&gt;&lt;/select&gt;</code>)にエラーとなっていたバグが修正されました。</p></li>
<li><p>サーバーサイドレンダリング時にselectタグのvalueがoptionタグのselectedとして反映されるようになりました。</p></li>
<li><p>同じdocumentに対して複数のReactのオブジェクトで要素を追加した状態になった時、イベントハンドリングのタイミングで発生していたエラーがなるべく起きないようになりました。但し、radio buttonを同じnameでrenderしていた場合などエラーになる状況は残っています。</p></li>
<li><p>小文字でないHTMLタグ名をReactDOMで使った場合でも問題にならないようになりました。ただしDOM Componentの場合には小文字で指定することを変わらずに推奨します。</p></li>
<li><p>ReactDOMが<code>animationIterationCount</code>、<code>boxOrdinalGroup</code>、<code>flexOrder</code>、<code>tabSize</code>、<code>stopOpacity</code>のCSSプロパティに対して'px'を追加しないようになりました。</p></li>
<li><p><code>react-addons-test-utils</code>で<code>Simulate.mouseEnter</code>と<code>Simulate.mouseLeave</code>が利用可能になりました。</p></li>
<li><p><code>react-addons-transition-group</code>で複数のnodeが同時に削除された場合にも正しく処理出来るようになりました。</p></li>
</ul>


<h2>ReactElement tags by Symbol</h2>

<p><a href="https://github.com/facebook/react/pull/4832">https://github.com/facebook/react/pull/4832</a></p>

<p>Reactではv0.14から<code>React.createElement</code>でReactElementのインスタンスではなくてただのオブジェクトが返ってくるようになっていたり、上の方で紹介したBabelによるinlineElementsの最適化によってcreateElementの呼び出しがただのオブジェクトに変換されることからも分かる通り、オブジェクトをそのままVIRTUAL DOMとして扱いDOMを生成することが出来ます。
そのためユーザーによって作成されるオブジェクトをそのままrenderに渡していると意図しないコンテンツを表示されたりXSSのリスクがあります。
(ユーザーが任意のオブジェクトをそのままReactElementとして描画出来ること自体が問題ではありますが)</p>

<ul>
<li><a href="https://github.com/facebook/react/issues/3473">How Much XSS Vulnerability Protection is React Responsible For? #3473</a></li>
</ul>


<p>そのため、信頼されたReactElementかどうかを判別するための方法が議論されていました。セキュリティに興味のある人はこの辺りのissueを見てみると面白いと思います。</p>

<ul>
<li><a href="https://github.com/facebook/react/pull/3583">[RFC] Trusted sources for React elements. #3583</a></li>
</ul>


<p>Reactでは最初はinstanceofでReactElementかどうかのチェックが行われていたのですが、それだと常にReactElementのインスタンスである必要がありオブジェクト化による最適化や複数のReactを使っていた場合にチェックが失敗するなど制限が多くなってしまいます。そのため、<code>_isReactElement</code>というがtrueかどうかをみるように変わりましたがこれでは信頼されたオブジェクトであるかを判定することは出来ません。</p>

<p>ユーザーが<code>_isReactElement</code>をオブジェクトに指定することでReactElementとして評価され、さらにReactには<code>dangerouslySetInnerHTML</code>というPropでHTMLをそのまま渡すことが出来るので&hellip;。</p>

<p>```js
{
  type:&ldquo;div&rdquo;,
  _isReactElement: true,
  props: {</p>

<pre><code>dangerouslySetInnerHTML: {
  __html: "&lt;img onload='alert(123)' src='http://blog.koba04.com/favicon.ico' /&gt;".
}
</code></pre>

<p>  }
}
```</p>

<p>v0.14ではSymbolを使って信頼されたReactElementかどうかを判定するようになります。</p>

<ul>
<li><a href="https://github.com/facebook/react/pull/4832">Use a Symbol to tag every ReactElement #4832</a></li>
</ul>


<h3>How it works?</h3>

<p>```js
var TYPE_SYMBOL = (typeof Symbol === &lsquo;function&rsquo; &amp;&amp; Symbol.for &amp;&amp;</p>

<pre><code>              Symbol.for('react.element')) || 0xeac7;
</code></pre>

<p>```
* <a href="https://github.com/facebook/react/blob/d54fa9e563d968112f5461274dc4e9d2aa6ed35c/src/isomorphic/classic/element/ReactElement.js#L20-L22">https://github.com/facebook/react/blob/d54fa9e563d968112f5461274dc4e9d2aa6ed35c/src/isomorphic/classic/element/ReactElement.js#L20-L22</a></p>

<p>上記のようにSymbolを保持していおいて、それを<code>React.createElement</code>で作成したObjectにも<code>$$typeof</code>というpropertyとして渡しておいて、ReactElementが有効であるかを返す<code>isValidElement</code>という関数の中の比較で利用しています。</p>

<p><code>Symbol.for</code>は指定されたSymbolがあればそれを返しなければ作成して返すので、グローバルなSymbolとして扱うことが出来ます。これによってただのオブジェクトも複数のReactを使っていた場合もサポートすることが出来ます。
(複数のReactがある場合は既に書いた通り別途warningが出ます)</p>

<p>Symbolが実装されていないような環境だと固定の値(0xeac7)になるので、この機能を有効にしたい場合はSymbolのpolyfillを入れておく必要があります。</p>

<p><a href="https://kangax.github.io/compat-table/es6/#Symbol">https://kangax.github.io/compat-table/es6/#Symbol</a></p>

<p>また、BabelのinlineElementsの最適化を使った場合にどうなるんだと思った人もいると思いますがすでに対応されて5.8.24としてリリースにされています。</p>

<p><a href="https://github.com/babel/babel/pull/2352">https://github.com/babel/babel/pull/2352</a></p>

<h2>v0.15?</h2>

<p>v0.15はGarbage collection releaseと位置づけられていて、つまりAPIの整理などに重点が置かれたリリースになる予定でv0.14のリリースから遠くないタイミングで出るそうです。</p>
]]></content>
  </entry>
  
</feed>
